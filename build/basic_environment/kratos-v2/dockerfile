from golang:1.16.4 as builder

ENV GOPATH /go
ENV CGO_ENABLED 0
ENV GO111MODULE on
ENV GOPROXY=https://goproxy.cn,direct

COPY ./google/bin/protoc $GOPATH/bin
COPY ./google/include/google $GOPATH/src/google

RUN go get -u google.golang.org/protobuf/cmd/protoc-gen-go@v1.26.0 \
    && go get -u google.golang.org/grpc/cmd/protoc-gen-go-grpc@v1.1.0 \
    && go get -u google.golang.org/grpc@v1.36.0 \
    && go get -u github.com/envoyproxy/protoc-gen-validate@v0.5.1 \
    && go get -u github.com/go-kratos/kratos/cmd/protoc-gen-go-http/v2@46acad3 \
    && go get -u github.com/go-kratos/kratos/cmd/protoc-gen-go-errors/v2@46acad3 \
    && go get -u github.com/go-kratos/kratos/v2@v2.0.0-beta3